package core;

import org.junit.jupiter.api.Test;
import org.mockito.Mockito;
import requests.IRequestCommand;
import requests.RequestFactory;

import java.util.List;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class TransactionManagerTest {
    TransactionManager managerUnderTest;
    IRequestCommand requester = Mockito.mock(IRequestCommand.class);
    Account account = Mockito.mock(Account.class);
    RequestFactory factory = Mockito.mock(RequestFactory.class);

    private String dummyResponse = """
                {
                  "feedItems": [
                    {
                      "feedItemUid": "11221122-1122-1122-1122-112211221122",
                      "categoryUid": "98765",
                      "amount": {
                        "currency": "GBP",
                        "minorUnits": 123456
                      },
                      "sourceAmount": {
                        "currency": "GBP",
                        "minorUnits": 123456
                      },
                      "direction": "OUT",
                      "updatedAt": "2021-08-23T18:32:06.105Z",
                      "transactionTime": "2021-08-23T18:32:06.105Z",
                      "settlementTime": "2021-08-23T18:32:06.105Z",
                      "retryAllocationUntilTime": "2021-08-23T18:32:06.105Z",
                      "source": "MASTER_CARD",
                      "sourceSubType": "CONTACTLESS",
                      "status": "PENDING",
                      "transactingApplicationUserUid": "aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa",
                      "counterPartyType": "MERCHANT",
                      "counterPartyUid": "68e16af4-c2c3-413b-bf93-1056b90097fa",
                      "counterPartyName": "Tesco",
                      "counterPartySubEntityUid": "35d46207-d90e-483c-a40a-128cc4da4bee",
                      "counterPartySubEntityName": "Tesco Southampton",
                      "counterPartySubEntityIdentifier": "608371",
                      "counterPartySubEntitySubIdentifier": "01234567",
                      "exchangeRate": 0,
                      "totalFees": 0,
                      "totalFeeAmount": {
                        "currency": "GBP",
                        "minorUnits": 123456
                      },
                      "reference": "TESCO-STORES-6148      SOUTHAMPTON   GBR",
                      "country": "GB",
                      "spendingCategory": "GROCERIES",
                      "userNote": "Tax deductable, submit me to payroll",
                      "roundUp": {
                        "goalCategoryUid": "68e16af4-c2c3-413b-bf93-1056b90097fa",
                        "amount": {
                          "currency": "GBP",
                          "minorUnits": 123456
                        }
                      },
                      "hasAttachment": true,
                      "hasReceipt": true
                    }
                  ]
                }""";
    private String aLargerResponse = """
            {"feedItems":[{"feedItemUid":"77d19bbb-0d71-4e0e-b152-6603fc483347","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":9999},"sourceAmount":{"currency":"GBP","minorUnits":9999},"direction":"OUT","updatedAt":"2021-08-23T21:37:51.201Z","transactionTime":"2021-08-23T21:37:50.899Z","settlementTime":"2021-08-23T21:37:51.158Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"4173dfaf-fc5d-4b4b-9331-c78cd13711d9","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"d6f63b22-79f1-440a-8a70-e8c1fc6ff4ad","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"57d180a8-a1c8-47a1-b78f-e72d085ded9b","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1201},"sourceAmount":{"currency":"GBP","minorUnits":1201},"direction":"OUT","updatedAt":"2021-08-23T21:37:48.311Z","transactionTime":"2021-08-23T21:37:48.208Z","settlementTime":"2021-08-23T21:37:48.282Z","source":"DIRECT_DEBIT","status":"SETTLED","counterPartyType":"MERCHANT","counterPartyUid":"b6c146f7-666e-4868-beed-21344b7e6e47","counterPartyName":"Society of Antiquaries aaa","counterPartySubEntityUid":"7dda8396-7c7a-46d3-b5af-61a187bf00f9","reference":"Thomas Cook","country":"GB","spendingCategory":"GENERAL","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77d1f456-e35f-4e1d-a1af-5e6d26b3a8bc","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":101},"sourceAmount":{"currency":"GBP","minorUnits":101},"direction":"OUT","updatedAt":"2021-08-23T21:37:43.903Z","transactionTime":"2021-08-23T21:37:43.674Z","settlementTime":"2021-08-23T21:37:43.862Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"3c61a136-db3e-4985-9f91-568df04f1a2d","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"570a8393-19d9-46b5-a645-38d16d289e63","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7295246f-61dc-4204-96a2-7ad87c49e022","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2301},"sourceAmount":{"currency":"GBP","minorUnits":2301},"direction":"OUT","updatedAt":"2021-08-23T21:35:04.978Z","transactionTime":"2021-08-23T21:35:04.731Z","settlementTime":"2021-08-23T21:35:04.936Z","source":"DIRECT_DEBIT","status":"SETTLED","counterPartyType":"MERCHANT","counterPartyUid":"b6c146f7-666e-4868-beed-21344b7e6e47","counterPartyName":"Society of Antiquaries aaa","counterPartySubEntityUid":"7dda8396-7c7a-46d3-b5af-61a187bf00f9","reference":"Volcano Insurance","country":"GB","spendingCategory":"GENERAL","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd1f17-afb3-4f09-84bd-80a268328dda","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3983},"sourceAmount":{"currency":"GBP","minorUnits":3983},"direction":"OUT","updatedAt":"2021-08-23T21:33:21.713Z","transactionTime":"2021-08-23T21:33:21.199Z","settlementTime":"2021-08-23T21:33:21.628Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"a6915434-d0e4-45f4-b555-bdae91aa14d6","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"d67252c3-f543-4719-9969-c068e75ebe41","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd43d1-dea4-4c3a-adef-49390b9978af","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":312},"sourceAmount":{"currency":"GBP","minorUnits":312},"direction":"OUT","updatedAt":"2021-08-23T21:33:21.760Z","transactionTime":"2021-08-23T21:33:21.078Z","settlementTime":"2021-08-23T21:33:21.713Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"4069cc85-8ce2-47b9-bb16-0f2f1e1c329d","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"f4cd8c79-c5e5-4b5c-9923-f199f4e3bd6c","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cdd584-7a60-4813-8da0-d9632200f55d","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2116},"sourceAmount":{"currency":"GBP","minorUnits":2116},"direction":"OUT","updatedAt":"2021-08-23T21:33:21.503Z","transactionTime":"2021-08-23T21:33:21.044Z","settlementTime":"2021-08-23T21:33:21.417Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"d9de7370-cddb-403c-9bdb-bea46a07b034","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"f96a83af-9049-49eb-823e-7337c9c1502e","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cdd04e-118b-4661-8a8a-b1233015b3b1","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1663},"sourceAmount":{"currency":"GBP","minorUnits":1663},"direction":"OUT","updatedAt":"2021-08-23T21:33:21.485Z","transactionTime":"2021-08-23T21:33:21.016Z","settlementTime":"2021-08-23T21:33:21.348Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"638418ee-4d82-4422-b1f1-e0ae03505b9d","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"ec939e69-940a-4eb4-a48f-24c81b68ea5b","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd6cee-a304-452e-ab34-add217422f96","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":694},"sourceAmount":{"currency":"GBP","minorUnits":694},"direction":"OUT","updatedAt":"2021-08-23T21:33:21.751Z","transactionTime":"2021-08-23T21:33:21.015Z","settlementTime":"2021-08-23T21:33:21.631Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"3ec2f654-8062-4316-abc0-f185d4a129e1","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"83da0995-e5d0-4b17-ab34-f8918bd662e7","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cdb739-1650-4100-9022-7f90af6e5beb","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3614},"sourceAmount":{"currency":"GBP","minorUnits":3614},"direction":"OUT","updatedAt":"2021-08-23T21:33:21.439Z","transactionTime":"2021-08-23T21:33:21.013Z","settlementTime":"2021-08-23T21:33:21.322Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"5135c184-6853-4eee-89d4-ebf125254b64","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"2d8ef4e0-1591-4b15-a1cb-519cd4a7bd1b","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd8c65-304e-4230-97c4-40051b08a753","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":200000},"sourceAmount":{"currency":"GBP","minorUnits":200000},"direction":"IN","updatedAt":"2021-08-23T21:33:20.355Z","transactionTime":"2021-08-23T21:33:20.000Z","settlementTime":"2021-08-23T21:33:20.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 2601516264","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cdf41e-0eac-4ea7-a97c-8b405c4cfb02","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3775},"sourceAmount":{"currency":"GBP","minorUnits":3775},"direction":"IN","updatedAt":"2021-08-23T21:33:20.671Z","transactionTime":"2021-08-23T21:33:20.000Z","settlementTime":"2021-08-23T21:33:20.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 4829551795","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cddf95-a1da-4ab2-9ea3-eaab89ea55ee","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3834},"sourceAmount":{"currency":"GBP","minorUnits":3834},"direction":"IN","updatedAt":"2021-08-23T21:33:20.692Z","transactionTime":"2021-08-23T21:33:20.000Z","settlementTime":"2021-08-23T21:33:20.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 6714217059","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd995c-605c-43d3-9418-2764cf65b519","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1732},"sourceAmount":{"currency":"GBP","minorUnits":1732},"direction":"IN","updatedAt":"2021-08-23T21:33:20.744Z","transactionTime":"2021-08-23T21:33:20.000Z","settlementTime":"2021-08-23T21:33:20.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 2729440931","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd8f48-6205-49cf-ad56-39e9d2378e91","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3835},"sourceAmount":{"currency":"GBP","minorUnits":3835},"direction":"IN","updatedAt":"2021-08-23T21:33:20.850Z","transactionTime":"2021-08-23T21:33:20.000Z","settlementTime":"2021-08-23T21:33:20.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 4520163533","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd9ad6-14b7-449d-b080-bae65a2dd936","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1000},"sourceAmount":{"currency":"GBP","minorUnits":1000},"direction":"IN","updatedAt":"2021-08-23T21:33:20.897Z","transactionTime":"2021-08-23T21:33:20.000Z","settlementTime":"2021-08-23T21:33:20.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 8276336320","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cd39dd-b01d-4280-8352-ce2dfb2fb4a6","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1614},"sourceAmount":{"currency":"GBP","minorUnits":1614},"direction":"IN","updatedAt":"2021-08-23T21:33:21.058Z","transactionTime":"2021-08-23T21:33:20.000Z","settlementTime":"2021-08-23T21:33:20.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 4922268535","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"77cdde4e-de68-4c90-9718-37b3e3d258a2","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":50000},"sourceAmount":{"currency":"GBP","minorUnits":50000},"direction":"IN","updatedAt":"2021-08-23T21:33:20.018Z","transactionTime":"2021-08-23T21:33:19.000Z","settlementTime":"2021-08-23T21:33:19.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 4490544015","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7609c2aa-1866-4c2b-be2e-275ca62f7136","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3705},"sourceAmount":{"currency":"GBP","minorUnits":3705},"direction":"OUT","updatedAt":"2021-08-23T14:01:36.879Z","transactionTime":"2021-08-23T14:01:36.344Z","settlementTime":"2021-08-23T14:01:36.777Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"69d8cdb2-2e24-4e22-995b-7b22aacb4fc9","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"2a99504f-bd61-4900-85b5-d17a3c963654","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7609ac3b-aa78-45b3-a075-0873128bfb44","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2561},"sourceAmount":{"currency":"GBP","minorUnits":2561},"direction":"OUT","updatedAt":"2021-08-23T14:01:36.812Z","transactionTime":"2021-08-23T14:01:36.257Z","settlementTime":"2021-08-23T14:01:36.748Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"648ce5b7-5593-484f-a6ca-a3fb2aced71f","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"0e1b43ee-d174-4aa8-82b3-ad05f6243f38","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7609f875-6def-4972-a1ce-d7000973e82a","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3112},"sourceAmount":{"currency":"GBP","minorUnits":3112},"direction":"OUT","updatedAt":"2021-08-23T14:01:36.880Z","transactionTime":"2021-08-23T14:01:36.257Z","settlementTime":"2021-08-23T14:01:36.824Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"ede910a8-5074-420e-ad03-15f5987a2854","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"c2c57add-1e29-4aae-bc38-865becfda6cd","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"76090853-f738-455b-83a0-389981008393","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3760},"sourceAmount":{"currency":"GBP","minorUnits":3760},"direction":"OUT","updatedAt":"2021-08-23T14:01:36.861Z","transactionTime":"2021-08-23T14:01:36.232Z","settlementTime":"2021-08-23T14:01:36.760Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"83028f32-2e71-45de-874a-f69c75b65ac9","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"70cdb0e9-cc42-4119-9530-81978e9fd53e","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"76097494-452a-4168-b8a3-3be9650b4458","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3383},"sourceAmount":{"currency":"GBP","minorUnits":3383},"direction":"OUT","updatedAt":"2021-08-23T14:01:36.712Z","transactionTime":"2021-08-23T14:01:36.205Z","settlementTime":"2021-08-23T14:01:36.542Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"36c68326-ea1f-4f95-acaa-04c2c7214f33","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"64d83f3c-b3ea-41f9-ba5b-fb7cac45e624","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"76092ee1-4a38-4792-ae7b-9dd88329ec71","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":371},"sourceAmount":{"currency":"GBP","minorUnits":371},"direction":"OUT","updatedAt":"2021-08-23T14:01:36.736Z","transactionTime":"2021-08-23T14:01:36.205Z","settlementTime":"2021-08-23T14:01:36.555Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"b2291a70-272d-42f0-a19e-f76f07531649","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"cc802d55-b596-4697-8ebf-d173158352e0","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7609ae4b-2411-49b3-a215-c0dfaff55297","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2048},"sourceAmount":{"currency":"GBP","minorUnits":2048},"direction":"IN","updatedAt":"2021-08-23T14:01:36.270Z","transactionTime":"2021-08-23T14:01:36.000Z","settlementTime":"2021-08-23T14:01:36.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 9619869704","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"76093d3e-4427-4f52-a8e3-e60db7a3d7d9","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":50000},"sourceAmount":{"currency":"GBP","minorUnits":50000},"direction":"IN","updatedAt":"2021-08-23T14:01:35.450Z","transactionTime":"2021-08-23T14:01:35.000Z","settlementTime":"2021-08-23T14:01:35.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 8388188582","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"76091bdb-99e6-4c48-a964-8be8a0bc683a","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":200000},"sourceAmount":{"currency":"GBP","minorUnits":200000},"direction":"IN","updatedAt":"2021-08-23T14:01:35.634Z","transactionTime":"2021-08-23T14:01:35.000Z","settlementTime":"2021-08-23T14:01:35.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 8898349790","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7609acaa-cf07-4283-b9da-fa23a464150f","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2610},"sourceAmount":{"currency":"GBP","minorUnits":2610},"direction":"IN","updatedAt":"2021-08-23T14:01:35.833Z","transactionTime":"2021-08-23T14:01:35.000Z","settlementTime":"2021-08-23T14:01:35.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 6135568973","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7609d15e-6ab7-4489-ac5a-696fb69c4879","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1207},"sourceAmount":{"currency":"GBP","minorUnits":1207},"direction":"IN","updatedAt":"2021-08-23T14:01:35.905Z","transactionTime":"2021-08-23T14:01:35.000Z","settlementTime":"2021-08-23T14:01:35.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 8108198812","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"76090467-902f-4744-9e76-0a19ef6bd5ec","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3048},"sourceAmount":{"currency":"GBP","minorUnits":3048},"direction":"IN","updatedAt":"2021-08-23T14:01:35.951Z","transactionTime":"2021-08-23T14:01:35.000Z","settlementTime":"2021-08-23T14:01:35.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 5768084914","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"76096591-b3c0-4f47-b2b6-65cfe993f1d0","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1794},"sourceAmount":{"currency":"GBP","minorUnits":1794},"direction":"IN","updatedAt":"2021-08-23T14:01:35.971Z","transactionTime":"2021-08-23T14:01:35.000Z","settlementTime":"2021-08-23T14:01:35.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 2652593511","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"7609e8bf-14cc-44db-af53-4bb4477811c3","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":965},"sourceAmount":{"currency":"GBP","minorUnits":965},"direction":"IN","updatedAt":"2021-08-23T14:01:36.046Z","transactionTime":"2021-08-23T14:01:35.000Z","settlementTime":"2021-08-23T14:01:35.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 1108606565","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557db689-c997-43e4-9a83-faa4b7f442c4","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1256},"sourceAmount":{"currency":"GBP","minorUnits":1256},"direction":"OUT","updatedAt":"2021-08-17T19:09:26.701Z","transactionTime":"2021-08-17T19:09:26.382Z","settlementTime":"2021-08-17T19:09:26.653Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"0d6a47ef-45c4-4386-9b41-e4f8b1bc37f7","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"402bcfe2-7f3c-4472-b08d-bc712986970c","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d8645-46ea-424c-8435-b74b340b4f53","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":435},"sourceAmount":{"currency":"GBP","minorUnits":435},"direction":"OUT","updatedAt":"2021-08-17T19:09:26.803Z","transactionTime":"2021-08-17T19:09:26.346Z","settlementTime":"2021-08-17T19:09:26.755Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"3613c9e9-4c40-4025-9ba4-676535c46f5d","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"2c34f30d-6e19-42e5-8f50-7eb5829a63ab","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557da722-91ca-44c5-9a39-b97c877218b5","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":459},"sourceAmount":{"currency":"GBP","minorUnits":459},"direction":"OUT","updatedAt":"2021-08-17T19:09:26.739Z","transactionTime":"2021-08-17T19:09:26.337Z","settlementTime":"2021-08-17T19:09:26.670Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"61bf1bb0-afcf-42b1-8742-165547fc2c61","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"5e572ac2-de3b-4837-86dd-2f1c2214e79e","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557df9ed-b6cd-40c3-aa31-0abe9d45f1de","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":3880},"sourceAmount":{"currency":"GBP","minorUnits":3880},"direction":"OUT","updatedAt":"2021-08-17T19:09:26.760Z","transactionTime":"2021-08-17T19:09:26.337Z","settlementTime":"2021-08-17T19:09:26.706Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"7d0ec83a-b60d-4f64-a4a6-03c2540dcb8d","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"bd3f24e2-25ee-4bf8-a4c0-1ea2cf7176df","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557dd89a-7789-4cb6-8e3f-8f602d8c2db0","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2062},"sourceAmount":{"currency":"GBP","minorUnits":2062},"direction":"OUT","updatedAt":"2021-08-17T19:09:26.629Z","transactionTime":"2021-08-17T19:09:26.322Z","settlementTime":"2021-08-17T19:09:26.568Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"846ae3e8-6e5e-4745-96f5-bdc9387e6de5","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"571cce3d-9065-4e7f-bc9a-7b1250bc71fd","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d992c-a4f3-4d6d-a742-dd5d5c384977","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2870},"sourceAmount":{"currency":"GBP","minorUnits":2870},"direction":"OUT","updatedAt":"2021-08-17T19:09:26.651Z","transactionTime":"2021-08-17T19:09:26.321Z","settlementTime":"2021-08-17T19:09:26.601Z","source":"FASTER_PAYMENTS_OUT","status":"SETTLED","counterPartyType":"PAYEE","counterPartyUid":"8e924f22-e87a-4092-b0f3-a8ea9f9f214f","counterPartyName":"Mickey Mouse","counterPartySubEntityUid":"9f25faaa-dff2-4d70-aa65-37c232e5932d","counterPartySubEntityName":"UK account","counterPartySubEntityIdentifier":"204514","counterPartySubEntitySubIdentifier":"00000825","reference":"External Payment","country":"GB","spendingCategory":"PAYMENTS","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d405d-3f4b-4ee6-a919-cbe99055964d","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":470},"sourceAmount":{"currency":"GBP","minorUnits":470},"direction":"IN","updatedAt":"2021-08-17T19:09:26.150Z","transactionTime":"2021-08-17T19:09:26.000Z","settlementTime":"2021-08-17T19:09:26.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 7679036665","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d2ede-da76-48e5-ace2-4e6331729eb5","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":1475},"sourceAmount":{"currency":"GBP","minorUnits":1475},"direction":"IN","updatedAt":"2021-08-17T19:09:26.226Z","transactionTime":"2021-08-17T19:09:26.000Z","settlementTime":"2021-08-17T19:09:26.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 4689177767","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d83f7-8cb0-4078-a179-63a5c5070ced","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":50000},"sourceAmount":{"currency":"GBP","minorUnits":50000},"direction":"IN","updatedAt":"2021-08-17T19:09:25.413Z","transactionTime":"2021-08-17T19:09:25.000Z","settlementTime":"2021-08-17T19:09:25.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 0529926970","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557dbd29-2de5-438f-b75b-40deb246a3d1","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":200000},"sourceAmount":{"currency":"GBP","minorUnits":200000},"direction":"IN","updatedAt":"2021-08-17T19:09:25.757Z","transactionTime":"2021-08-17T19:09:25.000Z","settlementTime":"2021-08-17T19:09:25.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 7177193595","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557dc4d4-2dc4-4027-af96-fa5db315b4ee","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":499},"sourceAmount":{"currency":"GBP","minorUnits":499},"direction":"IN","updatedAt":"2021-08-17T19:09:25.897Z","transactionTime":"2021-08-17T19:09:25.000Z","settlementTime":"2021-08-17T19:09:25.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 7360944840","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d48e6-bd65-4583-822d-e91b987efec9","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2462},"sourceAmount":{"currency":"GBP","minorUnits":2462},"direction":"IN","updatedAt":"2021-08-17T19:09:25.912Z","transactionTime":"2021-08-17T19:09:25.000Z","settlementTime":"2021-08-17T19:09:25.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 0874929687","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d7de0-b2f5-4ce5-8abc-2b7d701c3412","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2693},"sourceAmount":{"currency":"GBP","minorUnits":2693},"direction":"IN","updatedAt":"2021-08-17T19:09:25.992Z","transactionTime":"2021-08-17T19:09:25.000Z","settlementTime":"2021-08-17T19:09:25.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 8125222962","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false},{"feedItemUid":"557d456b-b6e3-4447-9656-9d6ff7d5582a","categoryUid":"e57fa9f1-e143-442a-bff4-3f0469d6d55e","amount":{"currency":"GBP","minorUnits":2187},"sourceAmount":{"currency":"GBP","minorUnits":2187},"direction":"IN","updatedAt":"2021-08-17T19:09:26.018Z","transactionTime":"2021-08-17T19:09:25.000Z","settlementTime":"2021-08-17T19:09:25.000Z","source":"FASTER_PAYMENTS_IN","status":"SETTLED","counterPartyType":"SENDER","counterPartyName":"Faster payment","counterPartySubEntityName":"","counterPartySubEntityIdentifier":"600522","counterPartySubEntitySubIdentifier":"20025033","reference":"Ref: 4458218538","country":"GB","spendingCategory":"INCOME","hasAttachment":false,"hasReceipt":false}]}
            """;
    @Test
    void testWhenGivenOneTransactionInResponse_ThenGetsTheRightTransaction() throws Exception {
        Mockito.when(factory.getRequestCommand(Mockito.any())).thenReturn(requester);
        Mockito.when(requester.getResponseCode()).thenReturn(200);
        Mockito.when(requester.getResponseBody()).thenReturn(dummyResponse);
        Mockito.when(account.getAccountUid()).thenReturn("12345");
        Mockito.when(account.getDefaultCategory()).thenReturn("98765");
        managerUnderTest = new TransactionManager(factory, account);
        List<Integer> listTransaction = managerUnderTest.getTransactionsFromPastWeek();
        assertEquals(123456, listTransaction.get(0)); // equivalent of 1234.56
    }

    @Test
    void testWhenGivenMultipleTransactionsInResponse_ThenGetsTheRightTransactions() throws Exception {
        Mockito.when(factory.getRequestCommand(Mockito.any())).thenReturn(requester);
        Mockito.when(requester.getResponseCode()).thenReturn(200);
        Mockito.when(requester.getResponseBody()).thenReturn(aLargerResponse);
        Mockito.when(account.getAccountUid()).thenReturn("12345");
        Mockito.when(account.getDefaultCategory()).thenReturn("98765");
        managerUnderTest = new TransactionManager(factory, account);
        List<Integer> listTransaction = managerUnderTest.getTransactionsFromPastWeek();
        assertEquals(46, listTransaction.size());
    }
}
